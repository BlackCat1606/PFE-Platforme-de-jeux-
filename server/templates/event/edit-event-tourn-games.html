{% extends "event/_page-edit-event.html" %}
{% import "_macros-form.html" as formMacros %}
{% import "event/_macros-event.html" as eventMacros %}

{% block editEventBody %}

<h1>{{ event.get('title') }} jeux de tournoi <span class="count">({{ tournamentEntries.length or '0' }})</span></h1>

<p>Cette page vous permet de gérer les jeux pour lesquels des scores élevés sont comptés dans le classement du tournoi.</p>

{% set canRefreshResult = ['playing', 'closed'].includes(event.get('status_tournament')) %}
{% if canRefreshResult %}
  <form method="post" class="form-inline">
    <p>
      {{ csrfToken() | safe }}
      <input type="submit" name="refresh" class="btn btn-primary" value="Refresh all tournament scores" 
        onclick="return confirm('Refresh all tournament scores?')" /> 
    </p>
  </form>
{% elseif event.get('status_tournament') === 'results' %}
  <p class="featured"><b>Remarque:</b> Les résultats du tournoi sont sortis. Les options d'actualisation des scores / classements ont été désactivées.</p>
{% endif %}

<div class="game-grid edit-event-tourn">
  {% for tournamentEntry in tournamentEntries %}
    {% set entry = tournamentEntry.related('entry') %}
    <div class="game-grid-entry">
      {{ eventMacros.entryThumb(entry) }}
      {% if entry.get('status_high_score') === 'off' %} 
        <div class="entry-thumb__form"><span class="label label-danger">Les scores élevés ne sont pas activés</span></div>
      {% endif %}
      <form method="post" class="form-inline form-group" style="margin-top: 5px">
        {{ csrfToken() | safe }}
        <input type="hidden" name="id" value="{{ entry.get('id') }}" />
        <label for="ordering">Ordre&nbsp;</label>
        <input type="text" name="ordering" class="form-control" value="{{ tournamentEntry.get('ordering') }}" style="max-width: 50px"  />
        <button type="submit" name="update" class="btn btn-primary">
          <span class="fas fa-save"></span>
        </button>
        {% if canRefreshResult %}
        <button type="submit" name="refresh" class="btn btn-default" onclick="return confirm('Refresh all tournament scores involving &quot;{{ entry.get('title').replace('\'', '\\\'') | escape }}&quot;?')">
          <span class="fas fa-sync"></span>
        </button>
        {% endif %}
        <button type="submit" name="remove" class="btn btn-default" onclick="return confirm('Remove &quot;{{ entry.get('title') | escape }}&quot; from the tournament?')">
          <span class="fas fa-trash"></span>
        </button>
      </form>
    </div>
  {% endfor %}
  <div class="game-grid-entry">
  <h3>Ajouter Jeu</h3>
  <form method="post" class="form-inline">
    {{ csrfToken() | safe }}
    <input type="number" name="add" class="form-control" placeholder="Entry ID" style="max-width: 120px" />
    <input type="submit" class="btn btn-primary" value="Ajouter" /> 
  </form>
  </div>
</div>

{% endblock %}
