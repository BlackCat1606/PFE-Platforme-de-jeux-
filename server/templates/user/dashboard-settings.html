{% extends "user/_page-dashboard.html" %}
{% import "_macros-form.html" as formMacros %}

{% block dashboardBody %}

<h1>Paramétres</h1>

<form action="{{ buildUrl(dashboardUser, 'user', 'settings', { dashboardAdminMode: dashboardAdminMode, query: 'upload=avatar' }) }}" method="post" enctype="multipart/form-data" class="js-warn-on-unsaved-changes">
{{ csrfToken() | safe }}

{% if dashboardAdminMode %}
<div class="alert alert-danger">
  <h2>Paramétres Admin</h2>

  <div class="form-group">
    <label for="name">Autorisations spéciales</label>
    <div>
      {{ formMacros.radio('special-permissions', 'none', 'Aucune', 'none' if not isMod(dashboardUser)) }}
      {{ formMacros.radio('special-permissions', 'mod', 'Moderateur', 'mod' if isMod(dashboardUser) and not isAdmin(dashboardUser)) }}
      {{ formMacros.radio('special-permissions', 'admin', 'Administrateur', 'admin' if isAdmin(dashboardUser)) }}
    </div>
  </div>
  <div class="form-group">
    <label for="name">Publications anonymes</label>
    <div>
      {{ formMacros.check('disallow-anonymous', 'Interdire la publication anonyme', dashboardUser.get('disallow_anonymous')) }}
    </div>
  </div>
  <div class="form-group">
    <input type="submit" class="btn btn-danger" value="Sauvegarder les modifications" />
    <a href="/user/{{ dashboardUser.get('name') }}" class="btn btn-default">Voir le profil</a>
  </div>
</div>
{% endif %}

<h2>Informations du compte</h2>

<div class="row">
  <div class="col-md-6 col-lg-7">
    <div class="form-group">
      <label for="title">Nom affiché</label>
      <input type="text" class="form-control input-lg" id="password" name="title" placeholder="Nom affiché" value="{{ dashboardUser.get('title') }}">
    </div> 

    <div class="form-group">
      <label for="name">Email</label>{{ formMacros.tooltip('Only used for password recovery. Any upcoming feature involving emails will be opt-in.', { placement: 'right' }) }}
      <input type="email" class="form-control" id="email" name="email" placeholder="Email" value="{{ dashboardUser.get('email') }}" required="required" />
    </div>

    {% set socialLinks = dashboardUser.related('details').get('social_links') %}
    <div class="form-group">
      <label for="name">Site Web</label>
      <input type="url" class="form-control" id="website" name="website" placeholder="http://" value="{{ socialLinks.website }}" />
    </div>

    <div class="form-group">
      <label for="name">Twitter</label>
      <input type="text" class="form-control" id="twitter" name="twitter" placeholder="@username" value="{{ '@' + socialLinks.twitter if socialLinks.twitter }}" />
    </div>

    <div class="form-group">
      <input type="submit" class="btn btn-primary" value="Sauvegarder les modifications" />
      <a href="/user/{{ dashboardUser.get('name') }}" class="btn btn-default">Voir le profil</a>
    </div>
  </div>

  <div class="col-md-6 col-lg-5">
    <div class="form-group">
      <label for="name">Avatar</label>
      {{ formMacros.pictureInput('avatar', dashboardUser.get('avatar'), { model: dashboardUser }) }}
    </div>
  </div>
</div>

<h2 class="spacing">Biographie</h2>

<div class="row">
  <div class="col-md-12">
    <div class="form-group">
      {{ formMacros.editor('body', dashboardUser.related('details').get('body'), 'user-details-' + dashboardUser.get('id')) }}
    </div>

    <div class="form-group">
      <input type="submit" class="btn btn-primary" value="Sauvegarder les modifications" />
      <a href="/user/{{ dashboardUser.get('name') }}" class="btn btn-default">Voir le profil</a>
    </div>
  </div>
</div>

</form>

<h2 class="spacing">Suppression de compte</h2>

<form action="{{ buildUrl(dashboardUser, 'user', 'settings', { dashboardAdminMode: dashboardAdminMode }) }}" method="post">
  {{ csrfToken() | safe }}
  <div class="form-group">
    <input type="submit" name="delete" class="btn btn-danger" value="Supprimer le compte"
      onclick="return confirm('Supprimer votre compte de manière permanente? Cela effacera VRAIMENT toutes vos données, y compris les publications et les commentaires. IMPORTANT: cela ne fonctionnera que * après * que vous ayez supprimé manuellement ou quitté l\'équipe pour toutes vos soumissions.')" />
  </div>
</form>

{% endblock %}

{% block scripts %} 
  {{ formMacros.editorScripts() }}
{% endblock %}
